<!DOCTYPE html>
<html>
<head>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type">

	<title>Investor Sentiment Analysis</title>
	<link href="amcharts/style.css" rel="stylesheet" type="text/css">
	<script src="amcharts/amcharts.js" type="text/javascript"></script>
	<script src="amcharts/serial.js" type="text/javascript"></script>
	<script src="amcharts/amstock.js" type="text/javascript"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
	<script type="text/javascript">
		var chartData = [];

		function drawChart() {
			chartData = []
			var ticker = document.request.symbol.value;
			var url = "http://www.quandl.com/api/v1/datasets/WIKI/"+ticker+".json?column=4&auth_token="
			$.getJSON( url, function( data ) {
				
			  $.each( data["data"], function( key, val ) {
					chartData.unshift({
						date: new Date(val[0]),
						value: val[1]
					});
			  });
			
			}).done(function() {
				createStockChart();
			  })
			return false;
		}
						
		AmCharts.ready(drawChart)


		function createStockChart() {
			var chart = new AmCharts.AmStockChart();
			chart.pathToImages = "amcharts/images/";

			// DATASETS //////////////////////////////////////////
			var dataSet = new AmCharts.DataSet();
			dataSet.color = "#b0de09";
			dataSet.fieldMappings = [{
				fromField: "value",
				toField: "value"
			}];
			dataSet.dataProvider = chartData;
			dataSet.categoryField = "date";

			chart.dataSets = [dataSet];

			// PANELS ///////////////////////////////////////////
			var stockPanel = new AmCharts.StockPanel();
			stockPanel.showCategoryAxis = true;
			stockPanel.title = "Value";
			stockPanel.eraseAll = false;

			var graph = new AmCharts.StockGraph();
			graph.valueField = "value";
			graph.bullet = "round";
			graph.bulletColor = "#FFFFFF";
			graph.bulletBorderColor = "#00BBCC";
			graph.bulletBorderAlpha = 1;
			graph.bulletBorderThickness = 2;
			graph.bulletSize = 7;
			graph.lineThickness = 2;
			graph.lineColor = "#00BBCC";
			graph.useDataSetColors = false;
			stockPanel.addStockGraph(graph);

			var stockLegend = new AmCharts.StockLegend();
			stockLegend.valueTextRegular = " ";
			stockLegend.markerType = "none";
			stockPanel.stockLegend = stockLegend;
			stockPanel.drawingIconsEnabled = true;

			chart.panels = [stockPanel];


			// OTHER SETTINGS ////////////////////////////////////
			var scrollbarSettings = new AmCharts.ChartScrollbarSettings();
			scrollbarSettings.graph = graph;
			chart.chartScrollbarSettings = scrollbarSettings;

			var cursorSettings = new AmCharts.ChartCursorSettings();
			cursorSettings.valueBalloonsEnabled = true;
			chart.chartCursorSettings = cursorSettings;

			var panelsSettings = new AmCharts.PanelsSettings();
			panelsSettings.creditsPosition = "bottom-right";
			chart.panelsSettings = panelsSettings;


			// PERIOD SELECTOR ///////////////////////////////////
			var periodSelector = new AmCharts.PeriodSelector();
			periodSelector.position = "bottom";
			periodSelector.periods = [{
				period: "DD",
				count: 10,
				label: "10 days"
			}, {
				period: "MM",
				count: 1,
				label: "1 month"
			}, {
				period: "YYYY",
				count: 1,
				label: "1 year"
			}, {
				period: "YTD",
				label: "YTD"
			}, {
				period: "MAX",
				label: "MAX"
			}];
			chart.periodSelector = periodSelector;

			chart.write('chartdiv');
		}
	</script>
</head>

<body style="background-color:#FFFFFF">
	<form action="#" id="request" name="request" onsubmit="return drawChart();">
		Ticker Symbol: <input name="symbol" type="text" value="GOOG"> <input type="submit" value="Submit">
	</form>


	<div id="chartdiv" style="width:100%; height:500px;">
	</div>
</body>
</html>